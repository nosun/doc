# 微信 Wifi物联网 开发总结

## 概述

基于wifi的微信物联网方案，目前有两种方式，一种是基于自己开发的html页面，一种是基于微信提供的模板，前一种基本上不用微信的设备接口（除了设备配网，扫描二维码），后一种则大量依赖微信的设备接口。前一种方案灵活度高，后一种方案用户体验好。

目前主要使用第一种方案完成微信设备开发。

### 方案

该方案包括以下组成部分：

### 基础部分

- 菜单生成：指定每个菜单所对应的url
- 用户授权：授权后可以获取用户的openid及用户信息，用户无感知，程序完成。

### 设备管理

- 设备配网：通过调用JSAPI触发AirKiss，实现Wifi设备配网。
- 添加设备：调用我方的API接口，实现添加绑定设备的流程，与APP过程一致。通过调用JSAPI，可实现扫描设备二维码。
- 设备列表：调用我方的API接口，实现设备列表展示。
- 设备锁定：锁定该设备，禁止其他人绑定。
- 设备解绑：解除绑定，从我的设备列表中移除该设备。

### 设备控制
- 控制页面：制作设备控制h5页面及交互效果，通过websocket协议实现与服务器保持长连接通信。
- 订阅设备：进入控制页面，通过websocket发送订阅设备的请求，实现设备订阅，实现心跳保持。
- 设备控制：通过http请求，通过厂方API接口，向设备发送控制指令，实现设备控制。
- 数据推送：设备端状态变化，服务端通过websocket服务实现数据推送。
- 协议解析：设备端推送过来的数据，通过js进行解析，在html页面展示设备状态变化的动态效果。

### 云服务
- 设备端长连接服务：与设备保持通信
- Websocket长连接服务：与网页进行通信

### 接口服务
- 设备绑定
- 设备解绑
- 获取设备详情
- 更新设备状态
- 获取设备列表
- 向设备发送指令


### 前端页面

- 设备列表页
- 添加设备-step1
- 添加设备-step2
- 添加设备-step3
- 设备控制页









